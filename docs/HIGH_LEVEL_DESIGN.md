# FinansKoç - High Level Design (HLD)

## 1. Sistem Genel Bakışı

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              FinansKoç Platformu                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐       │
│  │   Web Client    │     │   PWA Client    │     │  Mobile Browser │       │
│  │   (React SPA)   │     │   (Offline)     │     │   (Responsive)  │       │
│  └────────┬────────┘     └────────┬────────┘     └────────┬────────┘       │
│           │                       │                       │                 │
│           └───────────────────────┼───────────────────────┘                 │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Lovable Cloud (Supabase)                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
│  │  │   Auth      │  │  Database   │  │   Storage   │  │  Realtime  │  │   │
│  │  │  (JWT)      │  │ (PostgreSQL)│  │   (S3)      │  │ (WebSocket)│  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
│  │                                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
│  │  │                    Edge Functions (Deno)                      │   │   │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐ │   │   │
│  │  │  │  Email   │ │   AI     │ │   Push   │ │  External APIs   │ │   │   │
│  │  │  │ Service  │ │ Service  │ │ Notif.   │ │ (Crypto, FX)     │ │   │   │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────────────┘ │   │   │
│  │  └──────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        External Services                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐  │   │
│  │  │   Resend    │  │  CoinGecko  │  │ Exchange    │  │  Lovable   │  │   │
│  │  │  (Email)    │  │  (Crypto)   │  │ Rate API    │  │    AI      │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Mimari Tasarım

### 2.1 Frontend Mimarisi

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Frontend Architecture                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                      Presentation Layer                          │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────────┐│    │
│  │  │  Pages   │ │Components│ │  Layouts │ │    UI Components     ││    │
│  │  │          │ │          │ │          │ │    (shadcn/ui)       ││    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────────────────┘│    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                       State Management                           │    │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────┐ │    │
│  │  │  React Query     │  │  React Context   │  │  Local State   │ │    │
│  │  │  (Server State)  │  │  (Auth, Theme)   │  │  (UI State)    │ │    │
│  │  └──────────────────┘  └──────────────────┘  └────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                        Service Layer                             │    │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────┐ │    │
│  │  │  Supabase Client │  │     Hooks        │  │    Utilities   │ │    │
│  │  │  (API Calls)     │  │  (Custom Logic)  │  │   (Formatters) │ │    │
│  │  └──────────────────┘  └──────────────────┘  └────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Backend Mimarisi

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Backend Architecture                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                       API Gateway Layer                          │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │              Supabase PostgREST / Edge Functions          │   │    │
│  │  │           (Auto-generated REST API + Custom Logic)        │   │    │
│  │  └──────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                      Security Layer                              │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │    │
│  │  │  JWT Auth    │  │     RLS      │  │  Role-based Policies   │ │    │
│  │  │  Validation  │  │   Policies   │  │  (has_role function)   │ │    │
│  │  └──────────────┘  └──────────────┘  └────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                       Data Layer                                 │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │                    PostgreSQL Database                    │   │    │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────────────────┐│   │    │
│  │  │  │   Tables   │ │  Functions │ │       Triggers         ││   │    │
│  │  │  │            │ │            │ │                        ││   │    │
│  │  │  └────────────┘ └────────────┘ └────────────────────────┘│   │    │
│  │  └──────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Modül Yapısı

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Application Modules                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │   Core Module   │  │  Finance Module │  │ Investment Mod. │          │
│  │  ┌───────────┐  │  │  ┌───────────┐  │  │  ┌───────────┐  │          │
│  │  │   Auth    │  │  │  │ Accounts  │  │  │  │  Crypto   │  │          │
│  │  │  Profile  │  │  │  │  Cards    │  │  │  │ Currency  │  │          │
│  │  │ Settings  │  │  │  │Transactions│  │  │  │   Gold    │  │          │
│  │  └───────────┘  │  │  └───────────┘  │  │  └───────────┘  │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
│                                                                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │ Payments Module │  │  Budget Module  │  │  Family Module  │          │
│  │  ┌───────────┐  │  │  ┌───────────┐  │  │  ┌───────────┐  │          │
│  │  │  Fixed    │  │  │  │  Limits   │  │  │  │  Groups   │  │          │
│  │  │Installment│  │  │  │   Goals   │  │  │  │  Sharing  │  │          │
│  │  │   Loans   │  │  │  │  Reports  │  │  │  │  Invites  │  │          │
│  │  └───────────┘  │  │  └───────────┘  │  │  └───────────┘  │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
│                                                                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │   AI Module     │  │Notification Mod.│  │   Admin Module  │          │
│  │  ┌───────────┐  │  │  ┌───────────┐  │  │  ┌───────────┐  │          │
│  │  │  Advisor  │  │  │  │   Email   │  │  │  │   Users   │  │          │
│  │  │ Insights  │  │  │  │   Push    │  │  │  │ Analytics │  │          │
│  │  │  Scanner  │  │  │  │   Alerts  │  │  │  │  Security │  │          │
│  │  └───────────┘  │  │  └───────────┘  │  │  └───────────┘  │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Veri Akış Diyagramı

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Data Flow Diagram                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  User Action                                                             │
│      │                                                                   │
│      ▼                                                                   │
│  ┌──────────────────┐                                                   │
│  │  React Component │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐    Cache Hit?    ┌──────────────────┐             │
│  │   React Query    │ ────────────────▶│  Return Cached   │             │
│  │   (useQuery)     │      Yes         │      Data        │             │
│  └────────┬─────────┘                  └──────────────────┘             │
│           │ No                                                           │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  Supabase Client │                                                   │
│  │   (API Call)     │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │   PostgREST      │                                                   │
│  │   (REST API)     │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐    RLS Check     ┌──────────────────┐             │
│  │    PostgreSQL    │ ────────────────▶│  Access Denied   │             │
│  │   (with RLS)     │      Fail        │     (403)        │             │
│  └────────┬─────────┘                  └──────────────────┘             │
│           │ Pass                                                         │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  Return Data     │                                                   │
│  │   (JSON)         │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  React Query     │                                                   │
│  │  (Cache & State) │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │   UI Update      │                                                   │
│  │   (Re-render)    │                                                   │
│  └──────────────────┘                                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Güvenlik Mimarisi

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Security Architecture                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    Client-Side Security                          │    │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────┐ │    │
│  │  │  HTTPS Only      │  │  JWT Storage     │  │  Input Valid.  │ │    │
│  │  │  (TLS 1.3)       │  │  (localStorage)  │  │  (Zod Schema)  │ │    │
│  │  └──────────────────┘  └──────────────────┘  └────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    Transport Security                            │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │              HTTPS / WSS (Encrypted Transport)            │   │    │
│  │  │              JWT Bearer Token Authentication              │   │    │
│  │  └──────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    Server-Side Security                          │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │    │
│  │  │  JWT Verify  │  │     RLS      │  │  Security Definer      │ │    │
│  │  │  (Supabase)  │  │   Policies   │  │  Functions             │ │    │
│  │  └──────────────┘  └──────────────┘  └────────────────────────┘ │    │
│  │                                                                  │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────┐ │    │
│  │  │  Rate Limit  │  │  Suspicious  │  │  Admin-only Access     │ │    │
│  │  │  (Built-in)  │  │  Detection   │  │  (Role Check)          │ │    │
│  │  └──────────────┘  └──────────────┘  └────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                   │                                      │
│                                   ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                      Data Security                               │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │          Encrypted at Rest (Supabase Managed)             │   │    │
│  │  │          User Data Isolation (RLS)                        │   │    │
│  │  │          Audit Logging (login_events)                     │   │    │
│  │  └──────────────────────────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Bildirim Sistemi Akışı

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     Notification System Flow                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────┐                                                    │
│  │  Trigger Event  │                                                    │
│  │  (Budget Alert) │                                                    │
│  └────────┬────────┘                                                    │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────┐      ┌─────────────────┐                           │
│  │ DB Trigger      │─────▶│ Insert into     │                           │
│  │ (check_budget)  │      │ notifications   │                           │
│  └────────┬────────┘      └─────────────────┘                           │
│           │                                                              │
│           ▼                                                              │
│  ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐  │
│  │  pg_net HTTP    │─────▶│ Edge Function   │─────▶│  Web Push API   │  │
│  │  (async call)   │      │ (send-push)     │      │  (Browser)      │  │
│  └─────────────────┘      └─────────────────┘      └─────────────────┘  │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    Notification Channels                         │    │
│  │                                                                   │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │    │
│  │  │  In-App     │  │    Push     │  │        Email            │  │    │
│  │  │ (Bell Icon) │  │ (Browser)   │  │  (Daily/Weekly Report)  │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────────────────┘  │    │
│  │                                                                   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Deployment Mimarisi

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       Deployment Architecture                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                        Lovable Platform                          │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │                    Git Repository                         │   │    │
│  │  │              (Source Code & Configuration)                │   │    │
│  │  └──────────────────────────┬───────────────────────────────┘   │    │
│  │                             │                                    │    │
│  │                             ▼                                    │    │
│  │  ┌──────────────────────────────────────────────────────────┐   │    │
│  │  │                    Build Pipeline                         │   │    │
│  │  │  ┌────────────┐  ┌────────────┐  ┌────────────────────┐  │   │    │
│  │  │  │   Vite     │  │   Bundle   │  │    Optimize        │  │   │    │
│  │  │  │  (Build)   │  │  (Assets)  │  │   (Minify, etc.)   │  │   │    │
│  │  │  └────────────┘  └────────────┘  └────────────────────┘  │   │    │
│  │  └──────────────────────────┬───────────────────────────────┘   │    │
│  │                             │                                    │    │
│  │          ┌──────────────────┼──────────────────┐                │    │
│  │          ▼                  ▼                  ▼                │    │
│  │  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐        │    │
│  │  │   Preview    │   │  Production  │   │ Edge Functions│        │    │
│  │  │   (Staging)  │   │   (Live)     │   │   (Deploy)    │        │    │
│  │  └──────────────┘   └──────────────┘   └──────────────┘        │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                      Lovable Cloud (Supabase)                    │    │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌───────────┐  │    │
│  │  │  Database  │  │   Auth     │  │  Storage   │  │  Cron     │  │    │
│  │  │ (Postgres) │  │  (GoTrue)  │  │   (S3)     │  │ (pg_cron) │  │    │
│  │  └────────────┘  └────────────┘  └────────────┘  └───────────┘  │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Ölçeklenebilirlik

### 8.1 Horizontal Scaling
- Supabase managed altyapı ile otomatik
- Edge Functions serverless (auto-scale)
- CDN ile static asset dağıtımı

### 8.2 Performance Optimizations
- AI response caching (ai_cache tablosu)
- React Query client-side caching
- Lazy loading & code splitting
- Database indexing

### 8.3 Limitations
- PostgreSQL connection pooling (Supabase managed)
- Edge Function cold starts
- Rate limiting (Supabase defaults)

---

## 9. Disaster Recovery

| Bileşen | Strateji |
|---------|----------|
| Database | Supabase automated backups (PITR) |
| Code | Git version control |
| Secrets | Supabase secrets management |
| Edge Functions | Automatic redeployment |

---

## 10. Monitoring & Observability

| Alan | Araç/Yöntem |
|------|-------------|
| Application Logs | Supabase Dashboard |
| Database Logs | postgres_logs (analytics) |
| Auth Logs | auth_logs (analytics) |
| User Activity | page_views tablosu |
| Login Security | login_events tablosu |
| Email Analytics | email_analytics tablosu |

---

**Doküman Versiyonu**: 1.0  
**Son Güncelleme**: 2026-01-13
